<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Add Product</title>
    <!-- Add Bootstrap CSS -->
    <link
      href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <!-- Add Cropper CSS -->
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.12/cropper.min.css"
      rel="stylesheet"
    />
  </head>
  <body>
    <form
      action="/admin/addproducts"
      method="post"
      enctype="multipart/form-data"
    >
      <div class="container">
        <div
          class="row p-3 d-flex justify-content-center align-items-center shadow-sm mt-4"
          style="border-radius: 15px"
        >
          <div class="col-12 col-md-6" style="border-radius: 15px">
            <div
              class="formnav mt-3 shadow-sm d-flex justify-content-center align-items-center"
              style="
                color: white;
                background-color: rgb(255, 0, 0);
                border-radius: 15px;
                height: 50px;
              "
            >
              <h4 style="margin: 0px">ADD PRODUCT</h4>
            </div>
            <br />
            <label for="" id="err1" style="color: red; padding: 5px"></label
            ><br />
            <div class="d-flex mt-4 justify-content-center align-items-center">
              <input
                type="text"
                name="productName"
                id="proname"
                placeholder="Product Name"
                style="
                  width: 80%;
                  height: 35px;
                  border-radius: 5px;
                  padding-left: 5px;
                "
                required
              />
            </div>
            <br />
            <div class="d-flex justify-content-center">
              <textarea
                name="Specification1"
                placeholder="Specification1"
                style="
                  width: 38%;
                  height: 35px;
                  border-radius: 5px;
                  padding-left: 5px;
                  margin-right: 4%;
                "
                required
              ></textarea>
              <textarea
                name="Specification2"
                placeholder="Specification2"
                style="
                  width: 38%;
                  height: 35px;
                  border-radius: 5px;
                  padding-left: 5px;
                "
                required
              ></textarea>
            </div>
            <br />
            <div class="d-flex justify-content-center">
              <textarea
                name="Specification3"
                placeholder="Specification3"
                style="
                  width: 38%;
                  height: 35px;
                  border-radius: 5px;
                  padding-left: 5px;
                  margin-right: 4%;
                "
                required
              ></textarea>
              <textarea
                name="Specification4"
                placeholder="Specification4"
                style="
                  width: 38%;
                  height: 35px;
                  border-radius: 5px;
                  padding-left: 5px;
                "
                required
              ></textarea>
            </div>
            <br />
            <div class="d-flex justify-content-center align-items-center">
              <textarea
                name="Description"
                placeholder="Description"
                style="
                  width: 80%;
                  height: 35px;
                  border-radius: 5px;
                  padding-left: 5px;
                "
                required
              ></textarea>
            </div>
            <br />
            <div class="d-flex justify-content-center align-items-center">
              <select
                class=""
                id="category"
                name="category"
                required
                style="
                  width: 38%;
                  height: 35px;
                  border-radius: 5px;
                  padding-left: 5px;
                  margin-right: 4%;
                "
              >
                <option value="" selected disabled>Select a category</option>
                <!-- Categories options -->
              </select>
              <select
                class=""
                id="brand"
                name="BrandName"
                required
                style="
                  width: 38%;
                  height: 35px;
                  border-radius: 5px;
                  padding-left: 5px;
                "
              >
                <option value="" selected disabled>Select a Brand</option>
                <!-- Brands options -->
              </select>
            </div>
            <br />
            <div class="d-flex justify-content-center align-items-center">
              <input
                type="number"
                name="Price"
                placeholder="Enter the price"
                style="
                  width: 26%;
                  height: 35px;
                  border-radius: 5px;
                  padding-left: 5px;
                  margin-right: 4%;
                "
                required
              />
              <input
                type="number"
                name="DiscountAmount"
                placeholder="Discount Amount"
                style="
                  width: 26%;
                  height: 35px;
                  border-radius: 5px;
                  padding-left: 5px;
                  margin-right: 4%;
                "
                required
              />
              <input
                type="number"
                name="AvailableQuantity"
                placeholder="Stock"
                style="
                  width: 20%;
                  height: 35px;
                  border-radius: 5px;
                  padding-left: 5px;
                "
                required
              />
            </div>
            <br />
          </div>
          <div class="col-12 col-md-6 pt-5" style="border-radius: 15px">
            <div class="d-flex justify-content-center align-items-center">
              <!-- <input type="file" name="image" id="image" class="form-control" onchange="change(event,1)"> -->
            </div>
            <div class="d-flex justify-content-center align-items-center">
              <input
                type="file"
                name="images1"
                id="images1"
                accept="image/*"
                onchange="change(event,1)"
                style="
                  width: 38%;
                  height: 35px;
                  border-radius: 5px;
                  padding-left: 5px;
                  margin-right: 4%;
                "
                oninput="validateImage('imageInput1',1)"
                required
              />
              <input
                type="file"
                name="images2"
                id="images2"
                accept="image/*"
                onchange="change(event,2)"
                style="
                  width: 38%;
                  height: 35px;
                  border-radius: 5px;
                  padding-left: 5px;
                "
                oninput="validateImage('imageInput2',2)"
                required
              />
            </div>
            <div class="d-flex justify-content-center align-items-center">
              <input
                type="file"
                name="images3"
                id="images3"
                accept="image/*"
                oninput="validateImage('imageInput3',3)"
                onchange="change(event,3)"
                style="
                  width: 38%;
                  height: 35px;
                  border-radius: 5px;
                  padding-left: 5px;
                  margin-right: 4%;
                "
                required
              />

              <input
                type="file"
                name="images4"
                id="images4"
                accept="image/*"
                oninput="validateImage('imageInput4',4)"
                onchange="change(event,4)"
                style="
                  width: 38%;
                  height: 35px;
                  border-radius: 5px;
                  padding-left: 5px;
                "
                required
              />
            </div>
            <!-- <div class="d-flex justify-content-center align-items-center">
                <input type="file" name="images3" id="imageInput3" accept="image/*" oninput="validateImage('imageInput3',3)" onchange="change(event,3)"
                    style="width: 38%;height: 35px;border-radius: 5px;padding-left: 5px; margin-right: 4%;" required>
                
                <input type="file" name="images4" id="imageInput4" accept="image/*" oninput="validateImage('imageInput4',4)" onchange="change(event,4)"
                    style="width: 38%;height: 35px;border-radius: 5px;padding-left: 5px;" required>
            </div> -->
            <br />
            <!-- Image previews -->
            <div class="d-flex justify-content-center p-3">
              <div
                style="
                  width: 100px;
                  height: 100px;
                  margin-right: 4%;
                  margin-left: 4%;
                  border: 1px solid grey;
                "
              >
                <img
                  id="imagePreview1"
                  src="/assets/addimgaes.png"
                  alt="Image Preview 1"
                  style="width: 100px; height: 100px"
                />
              </div>
              <div
                style="
                  width: 100px;
                  height: 100px;
                  margin-right: 4%;
                  border: 1px solid grey;
                "
              >
                <img
                  id="imagePreview2"
                  src="/assets/addimgaes.png"
                  alt="Image Preview 2"
                  style="width: 100px; height: 100px"
                />
              </div>
              <div
                style="
                  width: 100px;
                  height: 100px;
                  margin-right: 4%;
                  border: 1px solid grey;
                "
              >
                <img
                  id="imagePreview3"
                  src="/assets/addimgaes.png"
                  alt="Image Preview 3"
                  style="width: 100px; height: 100px"
                />
              </div>
              <div style="width: 100px; height: 100px; border: 1px solid grey">
                <img
                  id="imagePreview4"
                  src="/assets/addimgaes.png"
                  alt="Image Preview 4"
                  style="width: 100px; height: 100px"
                />
              </div>
            </div>
            <div class="d-flex justify-content-center align-items-center">
              <input
                name="tag"
                placeholder="Tags"
                style="
                  width: 80%;
                  height: 35px;
                  border-radius: 5px;
                  padding-left: 5px;
                "
                required
              />
            </div>
            <div class="d-flex justify-content-center mt-4">
              <a href="/admin/product" class="btn btn-danger me-2 shadow-sm"
                >Cancel</a
              >
              <button
                type="submit"
                class="shadow-sm btn"
                style="background-color: rgb(0, 189, 0); color: white"
              >
                Add Product
              </button>
            </div>
            <br /><br />
          </div>
        </div>
      </div>
    </form>

    <div
      class="modal fade"
      id="modal"
      tabindex="-1"
      role="dialog"
      aria-labelledby="modalLabel"
      aria-hidden="true"
    >
      <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="modalLabel">Crop image</h5>
            <button
              type="button"
              class="close"
              data-dismiss="modal"
              aria-label="Close"
            >
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          <div class="modal-body">
            <div class="img-container">
              <div class="row">
                <div class="col-md-8">
                  <img id="cropperImage" class="img-fluid" />
                </div>
                <div class="col-md-4">
                  <div class="preview"></div>
                </div>
              </div>
            </div>
          </div>
          <div class="modal-footer">
            <button
              type="button"
              class="btn btn-secondary"
              data-dismiss="modal"
            >
              Cancel
            </button>
            <button type="button" class="btn btn-primary" id="crop">
              Crop
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Add jQuery -->
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <!-- Add Bootstrap JS -->
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"></script>
    <!-- Add Cropper JS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.12/cropper.min.js"></script>

    <script>
      //    $(document).ready(function () {
      //     var bs_modal = $("#modal");
      //     var image = document.getElementById("cropperImage");
      //     var cropper;

      //     $("#image").change(function (e) {
      //         var file = e.target.files[0];
      //         var reader = new FileReader();

      //         reader.onload = function (event) {
      //             image.src = event.target.result;
      //             bs_modal.modal("show");
      //         };

      //         reader.readAsDataURL(file);
      //     });

      //     bs_modal.on("shown.bs.modal", function () {
      //         cropper = new Cropper(image, {
      //             aspectRatio: 1,
      //             viewMode: 3,
      //             preview: ".preview",
      //         });
      //     }).on("hidden.bs.modal", function () {
      //         cropper.destroy();
      //         cropper = null;
      //     });

      //     $("#crop").click(function () {
      //         var canvas = cropper.getCroppedCanvas({
      //             width: 160,
      //             height: 160,
      //         });

      //         canvas.toBlob(function (blob) {
      //             var formData = new FormData();
      //             formData.append("image", blob, "cropped_image.png");

      //             $.ajax({
      //                 type: "POST",
      //                 processData: false,
      //                 contentType: false,
      //                 url: "/upload",
      //                 data: formData,
      //                 success: function (response, data) {
      //                     console.log("Success: ", data);
      //                     // Assuming you have a success message or action here
      //                     bs_modal.modal("hide");
      //                 },
      //                 error: function (xhr, status, error) {
      //                     console.error("Error: ", xhr.responseText);
      //                     // Handle error here
      //                     bs_modal.modal("hide");
      //                 },
      //             });

      //             // Update the image preview after cropping
      //             var croppedImageUrl = URL.createObjectURL(blob);
      //             document.getElementById("imagePreview").src = croppedImageUrl;
      //         });
      //     });
      // });

      // // Function to handle file input change
      // function change(event,no) {
      //     // var file = event.target.files[0];
      //     // var imagePreview = document.getElementById("imagePreview");

      //     // var reader = new FileReader();
      //     // reader.onload = function (event) {
      //     //     imagePreview.src = event.target.result;
      //     // };
      //     // reader.readAsDataURL(file);
      //     document.getElementById(`imagePreview${no}`).src=URL.createObjectURL(event.target.files[0])
      // }

      // // Function for validation
      // function validation(id) {
      //     console.log("yes working");
      //     console.log(id);
      //     const submitButton = document.getElementById('submit');
      //     const errorMsg = document.getElementById('err1');
      //     var val = document.getElementById(id).value;

      //     if (val.trim() === "") {
      //         errorMsg.textContent = 'Only space doesn\'t accept';
      //         submitButton.disabled = true;
      //     } else if (val.startsWith(' ')) {
      //         errorMsg.textContent = 'Text should not start with space';
      //         submitButton.disabled = true;
      //     } else {
      //         errorMsg.textContent = '';
      //         submitButton.disabled = false;
      //     }
      // }
      $(document).ready(function () {
        var bs_modal = $("#modal");
        var croppers = [];

        // Function to handle file change and update preview image
        function change(event, no) {
          console.log("this is oke or ok");
          document.getElementById(`imagePreview${no}`).src =
            URL.createObjectURL(event.target.files[0]);
          console.log(
            (document.getElementById(`imagePreview${no}`).src =
              URL.createObjectURL(event.target.files[0]))
          );

          // Show modal only if it's the first time the corresponding input file is changed
          if (!croppers[no]) {
            bs_modal.modal("show");
          }
        }

        // Event listener for file input change
        $("input[type=file]").change(function (e) {
          var fileInput = $(this);
          var file = e.target.files[0];
          var reader = new FileReader();
          var cropperId = fileInput.attr("id").slice(-1);

          reader.onload = function (event) {
            // Destroy the previous cropper instance if it exists
            if (croppers[cropperId]) {
              croppers[cropperId].destroy();
            }
            var image = document.getElementById("cropperImage");

            image.onload = function () {
              var cropper = new Cropper(image, {
                aspectRatio: 1,
                viewMode: 3,
                preview: ".preview",
              });

              // Handle cropping
              $("#crop").click(function () {
                var canvas = cropper.getCroppedCanvas({
                  width: 260,
                  height: 260,
                });

                if (canvas) {
                  canvas.toBlob(function (blob) {
                    $("#imagePreview" + cropperId).attr(
                      "src",
                      URL.createObjectURL(blob)
                    );

                    bs_modal.modal("hide");
                  });
                } else {
                  console.error("Canvas is null or invalid.");
                  bs_modal.modal("hide");
                }
              });

              croppers[cropperId] = cropper;
            };

            image.src = event.target.result;
          };

          reader.readAsDataURL(file);

          // Call change function to update preview image and show modal if necessary
          change(e, cropperId);
        });

        // Function to handle closing modal
        bs_modal.on("hidden.bs.modal", function () {
          // Destroy all croppers
          croppers.forEach(function (cropper) {
            cropper.destroy();
          });
          croppers = []; // Reset croppers array
        });
      });
    </script>
    <!-- <script>
    $(document).ready(function () {
        // Function for image cropping
        function cropImage(image, fileInput) {
            var cropper = new Cropper(image, {
                aspectRatio: 1,
                viewMode: 3,
                preview: ".preview",
            });

            $('#crop').click(function () {
                var canvas = cropper.getCroppedCanvas({
                    width: 160,
                    height: 160,
                });

                canvas.toBlob(function (blob) {
                    var formData = new FormData();
                    formData.append("image", blob, "cropped_image.png");

                    $.ajax({
                        type: "POST",
                        processData: false,
                        contentType: false,
                        url: "/upload",
                        data: formData,
                        success: function (response, data) {
                            console.log("Success: ", data);
                            // Assuming you have a success message or action here
                        },
                        error: function (xhr, status, error) {
                            console.error("Error: ", xhr.responseText);
                            // Handle error here
                        },
                    });

                    // Update the image preview after cropping
                    var croppedImageUrl = URL.createObjectURL(blob);
                    $(fileInput).siblings(".image-preview").attr("src", croppedImageUrl);
                });
            });
        }

        // Event listener for file input change
        $("input[type=file]").change(function (e) {
            var fileInput = this;
            var file = e.target.files[0];
            var reader = new FileReader();

            reader.onload = function (event) {
                $(fileInput).siblings(".cropper-container").removeClass("d-none");
                $(fileInput).siblings(".image-preview").attr("src", event.target.result);
                cropImage($(fileInput).siblings("img")[0], fileInput);
            };

            reader.readAsDataURL(file);
        });
    });
</script> -->
  </body>
</html>
