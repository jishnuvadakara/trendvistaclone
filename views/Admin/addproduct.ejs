<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>u-Profile</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC"
      crossorigin="anonymous"
    />

    <script></script>
    <script
      src="https://kit.fontawesome.com/65b842e152.js"
      crossorigin="anonymous"
    ></script>

    <link
      href="https://fonts.googleapis.com/css?family=Poppins:100,200,300,400,500,600,700,800,900&display=swap"
      rel="stylesheet"
    />

    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.12/cropper.min.css"
    />

    <!-- Additional CSS Files -->
    <link rel="stylesheet" type="text/css" href="/css/bootstrap.min.css" />

    <link rel="stylesheet" type="text/css" href="/css/font-awesome.css" />

    <link rel="stylesheet" href="/css/templatemo-hexashop.css" />

    <link rel="stylesheet" href="/css/owl-carousel.css" />
  


    <link rel="stylesheet" href="/css/lightbox.css" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/css/bootstrap.min.css"
    />
      
  


  </head>



 <!-- action="/admin/addproducts" method="post" -->
 

<form  action="/admin/addproducts" method="post" enctype="multipart/form-data"   id="productForm" style="height: 1000px;">
    <div class="container">
    <div class="row p-3 d-flex justify-content-center align-items-center shadow-sm mt-4" style="border-radius: 15px;">
       
        <div class="col-12 col-md-6 "
            style="border-radius: 15px;">
            <!-- <div class="formnav mt-3 shadow-sm d-flex justify-content-center align-items-center" style="color:white; background-color: black;border-radius: 15px; height: 50px;"><h4>TREND-VISTA</h4></div> -->
            <div class="formnav mt-3 shadow-sm d-flex justify-content-center align-items-center" style="color:white; background-color: rgb(255, 0, 0);border-radius: 15px; height: 50px;"><h4 style="margin: 0px;">ADD PRODUCT</h4></div>
           
            <br> <label for="" id="err1" style="color: red; padding:5px;"></label><br>
            
            <div class="d-flex mt-4 justify-content-center align-items-center">
                <input type="text" name="productName" id="proname" placeholder="Product Name"
                    style="width: 80%;height: 35px;border-radius: 5px;padding-left: 5px;" oninput="validation('proname')"  required>
            </div><br>
            <!-- <input type="hidden" name="status" value="Active">
            <div class="d-flex mt-2 justify-content-center align-items-center">
                <input type="text" name="BrandName" placeholder="Barand Name" id="brname"
                    style="width: 80%;height: 35px;border-radius: 5px;padding-left: 5px;" oninput="validation('brname')" required>
            </div>
            <br> -->
            <div class="d-flex justify-content-center">
                <textarea name="Specification1" placeholder="Specification1" id="spec1"
                    style="width: 38%;height: 35px;border-radius: 5px;padding-left: 5px;margin-right: 4%;" oninput="validation('spec1')" required></textarea>
                <textarea name="Specification2" placeholder="Specification2"
                    style="width: 38%;height: 35px;border-radius: 5px;padding-left: 5px;" id="spec2" oninput="validation('spec2')" required></textarea>
            </div>
            <br>
            <div class="d-flex justify-content-center">
                <textarea name="Specification3" placeholder="Specification3"
                    style="width: 38%;height: 35px;border-radius: 5px;padding-left: 5px;margin-right: 4%;" id="spec3"  oninput="validation('spec3')" required></textarea>
                <textarea name="Specification4" placeholder="Specification4"
                    style="width: 38%;height: 35px;border-radius: 5px;padding-left: 5px;" id="spec4" oninput="validation('spec4')" required></textarea>
            </div>
            
            <br>
            <div class="d-flex justify-content-center align-items-center">
                <textarea name="Description" placeholder="Description"
                    style="width: 80%;height: 35px;border-radius: 5px;padding-left: 5px;" id="dec" oninput="validation('dec')" required></textarea>
            </div>
            <br>
            <div class="d-flex justify-content-center align-items-center ">
                                      
                
                </select>
                <select class="" id="catagory" name="catagory" required
                style="width: 38%;height: 35px;border-radius: 5px;padding-left: 5px;margin-right: 4%;"  >
                <option value="" selected disabled>Select a catagory</option>
                       <% catagories.forEach((ele)=>{ %>
                            <option value="<%-ele._id-%>"> <%-ele.catagoryname -%></option>
                      <%})%>
                      
                  
                </select>
  
                <select class="" id="brand" name="BrandName" required
                style="width: 38%;height: 35px;border-radius: 5px;padding-left: 5px;"  >
                <option value="" selected disabled>Select a Brand</option>
                 <% Brands.forEach((ele)=>{ %>
                        <option ><%-ele.Brandname-%></option>
                   <%})%>
              
            </select>
  
                
            </div>
            <br>
            <div class="d-flex justify-content-center align-items-center">
                <input type="number" name="Price" placeholder="Enter the price"
                    style="width: 26%;height: 35px;border-radius: 5px;padding-left: 5px;margin-right: 4%;" required>
                     <!-- <input type="file" name="image" id="image" class="form-control" /> -->
                <input type="number" name="DiscountAmount" placeholder="Discount Amount"
                    style="width: 26%;height: 35px;border-radius: 5px;padding-left: 5px;margin-right: 4%;" required>
                <input type="number" name="AvailableQuantity" placeholder="Stock"
                    style="width: 20%;height: 35px;border-radius: 5px;padding-left: 5px;" required>
            </div>
            <br>
            </div>
            <div class="col-12 col-md-6 pt-5  "
            style="border-radius: 15px;">
  
            <div class="d-flex justify-content-center align-items-center" >
               
                <!-- <input type="file" name="images1" id="imageInput1" accept="image/*" onchange="change(event,1)"
                    style="width: 38%;height: 35px;border-radius: 5px;padding-left: 5px;margin-right: 4%;" oninput="validateImage('imageInput1',1)" required> -->
                <!-- <input type="file" name="images2" id="imageInput2" accept="image/*" onchange="change(event,2)"
                    style="width: 38%;height: 35px;border-radius: 5px;padding-left: 5px;" oninput="validateImage('imageInput2',2)" required> -->
                     <input
                type="file"
                name="images1"
                id="images1"
                accept="image/*"
                onchange="change(event,1)"
                style="
                  width: 38%;
                  height: 35px;
                  border-radius: 5px;
                  padding-left: 5px;
                  margin-right: 4%;
                "
                required
              />
              <input
                type="file"
                name="images2"
                id="images2"
                accept="image/*"
                onchange="change(event,2)"
                style="
                  width: 38%;
                  height: 35px;
                  border-radius: 5px;
                  padding-left: 5px;
                "
                required
              />
            </div>
            <br>
            <div class="d-flex justify-content-center align-items-center">
                <!-- <input type="file" name="images3" id="imageInput3" accept="image/*" oninput="validateImage('imageInput3',3)" onchange="change(event,3)"
                    style="width: 38%;height: 35px;border-radius: 5px;padding-left: 5px; margin-right: 4%;" required> -->
                
                <!-- <input type="file" name="images4" id="imageInput4" accept="image/*" oninput="validateImage('imageInput4',4)" onchange="change(event,4)"
                    style="width: 38%;height: 35px;border-radius: 5px;padding-left: 5px;" required> -->
                     <input
                type="file"
                name="images3"
                id="images3"
                accept="image/*"
                onchange="change(event,3)"
                style="
                  width: 38%;
                  height: 35px;
                  border-radius: 5px;
                  padding-left: 5px;
                  margin-right: 4%;
                "
                required
              />
              <input
                type="file"
                name="images4"
                id="images4"
                accept="image/*"
                onchange="change(event,4)"
                style="
                  width: 38%;
                  height: 35px;
                  border-radius: 5px;
                  padding-left: 5px;
                "
                required
              />
            </div>
            <div class="d-flex justify-content-center p-3">
               <div
                style="
                  width: 100px;
                  height: 100px;
                  margin-right: 4%;
                  margin-left: 4%;
                  border: 1px solid grey;
                "
              >
                <img
                  id="imagePreview1"
                  src="/assets/addimgaes.png"
                  alt="Image Preview 1"
                  style="width: 100px; height: 100px"
                />
              </div>
                <div
                style="
                  width: 100px;
                  height: 100px;
                  margin-right: 4%;
                  margin-left: 4%;
                  border: 1px solid grey;
                "
              >
                <img
                  id="imagePreview2"
                  src="/assets/addimgaes.png"
                  alt="Image Preview 2"
                  style="width: 100px; height: 100px"
                />
              </div>
                 <div
                style="
                  width: 100px;
                  height: 100px;
                  margin-right: 4%;
                  margin-left: 4%;
                  border: 1px solid grey;
                "
              >
                <img
                  id="imagePreview3"
                  src="/assets/addimgaes.png"
                  alt="Image Preview 3"
                  style="width: 100px; height: 100px"
                />
              </div>
                <div
                style="
                  width: 100px;
                  height: 100px;
                  margin-right: 4%;
                  border: 1px solid grey;
                "
              >
                <img
                  id="imagePreview4"
                  src="/assets/addimgaes.png"
                  alt="Image Preview 4"
                  style="width: 100px; height: 100px"
                />
              </div>
            </div>
            <div class="d-flex justify-content-center align-items-center">
                <input name="tag" placeholder="Tags"
                    style="width: 80%;height: 35px;border-radius: 5px;padding-left: 5px;" id="tag" oninput="validation('tags')"  required></input>
            </div>
            <div class="d-flex justify-content-center mt-4">
                <a href="/admin/product" class="btn btn-danger me-2 shadow-sm">Cancel</a>  <button type="submit" id="submit" class="shadow-sm btn" style="background-color: rgb(0, 189, 0);color: white;" >Add Product</button>
            </div>
            <br><br>
        </div>
    </div>
  </div><br><br>
  </form>
  <!-- Modal -->
    <div
      class="modal fade"
      id="modal"
      tabindex="-1"
      role="dialog"
      aria-labelledby="modalLabel"
      aria-hidden="true"
      
    >
      <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="modalLabel">Crop image</h5>
            <button
              type="button"
              class="close"
              data-dismiss="modal"
              aria-label="Close"
            >
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          <div class="modal-body">
            <div class="img-container">
              <div class="row" >
                <div class="col-md-8">
                  <img id="cropperImage" class="img-fluid" />
                </div>
                <div class="col-md-4">
                  <div class="preview"></div>
                </div>
              </div>
            </div>
          </div>
          <div class="modal-footer">
            <button
              type="button"
              class="btn btn-secondary"
              data-dismiss="modal"
            >
              Cancel
            </button>
            <button type="button" class="btn btn-primary" id="crop">
              Crop
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script> -->
    <!-- Add jQuery -->
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <!-- Add Bootstrap JS -->
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"></script>
    <!-- Add Cropper JS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.12/cropper.min.js"></script>

  <script>

  

    function change(event,no){
        console.log("this is oke or ok");
        document.getElementById(`imagePreview${no}`).src=URL.createObjectURL(event.target.files[0])
    }

    function validation(id){
        // console.log("yes workign");
        // console.log(id);
        const submitButton=document.getElementById('submit')
        const errorMsg=document.getElementById('err1')
        var val=document.getElementById(''+id).value

    
        if(val.trim()===""){
            errorMsg.textContent='Only space doesn\'t accept'
            submitButton.disabled=true
        }else if(val.startsWith(' ')){
            errorMsg.textContent='Text should not strat with space'
            submitButton.disabled=true
        }else{
            errorMsg.textContent=''
            submitButton.disabled=false
        }

    }

    document.addEventListener('DOMContentLoaded',function(){
        const priceInput=document.querySelector('input[name="Price"]')
        const discountInput=document.querySelector('input[name="DiscountAmount"]')
        const quantityInput=document.querySelector('input[name="AvailableQuantity"]')
        const productname=document.querySelector('input[name="Productname"]')
        const brandname=document.querySelector('input[name="Brandname"]')

        const errorMsg=document.getElementById('err1')
        const submitButton=document.getElementById('submit')

        priceInput.addEventListener('input',validateInputs)
        discountInput.addEventListener('input',validateInputs)
        quantityInput.addEventListener('input',validateInputs)

        function validateInputs(){
            const priceValue=parseFloat(priceInput.value) ||0
            const discoutnValue=parseFloat(discountInput.value)||0
            const quatutyValue=parseFloat(quantityInput.value)||0

            if(discoutnValue> priceValue||discoutnValue<0){
                errorMsg.textContent=discoutnValue> priceValue
                ? 'Discount cannot be greater than the price.'
                : 'Discount cannot be a negative value.'
                submitButton.disabled=true
            }else if(quatutyValue<0){
                errorMsg.textContent='Quantity cannot be a negative value'
                submitButton.disabled=true
            }else{
                errorMsg.textContent=""
                submitButton.disabled=false
            }

        }

    })

   
  </script>
  
    

<script>
 $(document).ready(function () {
    var bs_modal = $("#modal");
    var croppers = [];

    // Function to handle file change and update preview image
    function change(event, no) {
        console.log("File changed, updating preview image...");
        document.getElementById(`imagePreview${no}`).src =
            URL.createObjectURL(event.target.files[0]);

        // Show modal only if it's the first time the corresponding input file is changed
        if (!croppers[no]) {
            bs_modal.modal("show");
        }
    }

    // Event listener for file input change
    $("input[type=file]").change(function (e) {
        var fileInput = $(this);
        var file = e.target.files[0];
        var reader = new FileReader();
        var cropperId = fileInput.attr("id").slice(-1);

        reader.onload = function (event) {
            // Destroy the previous cropper instance if it exists
            if (croppers[cropperId]) {
                croppers[cropperId].destroy();
            }
            var image = document.getElementById("cropperImage");

            image.onload = function () {
                var cropper = new Cropper(image, {
                    aspectRatio: 1,
                    viewMode: 3,
                    preview: ".preview",
                });

                // Handle cropping
                $("#crop").click(function () {
                    var canvas = cropper.getCroppedCanvas({
                        width: 260,
                        height: 260,
                    });

                    if (canvas) {
                        canvas.toBlob(function (blob) {
                            if (blob) {
                                console.log("Blob created successfully:", blob);
                                var imageUrl = URL.createObjectURL(blob); // Convert blob to URL
                                console.log("Image URL:", imageUrl);
                                $("#imagePreview" + cropperId).attr("src", imageUrl);

                                // Store cropped image URL for sending it along with the form data
                                fileInput.data("croppedImage", blob);

                                bs_modal.modal("hide");
                            } else {
                                console.error("Blob is null or invalid.");
                            }
                        });
                    } else {
                        console.error("Canvas is null or invalid.");
                        bs_modal.modal("hide");
                    }
                });

                croppers[cropperId] = cropper;
            };

            image.src = event.target.result;
            
        };

        reader.readAsDataURL(file);

        // Call change function to update preview image and show modal if necessary
        change(e, cropperId);
    });

    // Function to handle closing modal
    bs_modal.on("hidden.bs.modal", function () {
        // Destroy all croppers
        croppers.forEach(function (cropper) {
            cropper.destroy();
        });
        croppers = []; // Reset croppers array
    });

    // Event listener for form submission
    $("#productForm").submit(function (e) {
        e.preventDefault(); // Prevent default form submission

        // Serialize form data
        var formData = new FormData();
        console.log("🚀 ~ file: addproduct.ejs:460 ~ formData:", formData)
         var formDataSerialized = $(this).serializeArray();
        $.each(formDataSerialized, function (index, item) {
            console.log("🚀 ~ file: addproduct.ejs:463 ~ item:", item)
            formData.append(item.name, item.value);
        })

        // Add cropped image blobs to formData
        $("input[type=file]").each(function () {
            var croppedImage = $(this).data("croppedImage");
            if (croppedImage) {
                formData.append($(this).attr("name"), croppedImage);
            }
        });
          console.log(formData,'this is the data');
        // Perform AJAX request
        $.ajax({
            url: $(this).attr("action"), // Form action URL
            type: $(this).attr("method"), // Form method (POST)
            data: formData,
            processData: false,
            contentType: false,
            success: function (response) {
                // Handle success response
                
            },
            error: function (xhr, status, error) {
                // Handle error
                console.error("Error:", error);
            }
        });
    });
});



</script>




<%-include('../layout/admin/footer.ejs')-%>


 <!-- // $(document).ready(function () {
      //   var bs_modal = $("#modal");
      //   var croppers = []; 

      //   // Function to handle file change and update preview image
      //   function change(event, no) {
      //     console.log("this is oke or ok");
      //     document.getElementById(`imagePreview${no}`).src =
      //       URL.createObjectURL(event.target.files[0]);
      //    console.log( document.getElementById(`imagePreview${no}`).src =
      //       URL.createObjectURL(event.target.files[0]));

      //     // Show modal only if it's the first time the corresponding input file is changed
      //     if (!croppers[no]) {
      //       bs_modal.modal("show");
      //     }
      //   }

      //   // Event listener for file input change
      //   $("input[type=file]").change(function (e) {
      //     var fileInput = $(this);
      //     var file = e.target.files[0];
      //     var reader = new FileReader();
      //     var cropperId = fileInput.attr("id").slice(-1);

      //     reader.onload = function (event) {
      //       // Destroy the previous cropper instance if it exists
      //       if (croppers[cropperId]) {
      //         croppers[cropperId].destroy();
      //       }
      //       var image = document.getElementById("cropperImage");

      //       image.onload = function () {
      //         var cropper = new Cropper(image, {
      //           aspectRatio: 1,
      //           viewMode: 3,
      //           preview: ".preview",
      //         });

      //         // Handle cropping
      //         $("#crop").click(function () {
      //           var canvas = cropper.getCroppedCanvas({
      //             width: 260,
      //             height: 260,
      //           });

      //           if (canvas) {
      //             canvas.toBlob(function (blob) {
      //               $("#imagePreview" + cropperId).attr(
      //                 "src",
      //                 URL.createObjectURL(blob)
      //               );
                     
      //               bs_modal.modal("hide");
      //             });
      //           } else {
      //             console.error("Canvas is null or invalid.");
      //             bs_modal.modal("hide");
      //           }
      //         });

      //         croppers[cropperId] = cropper;
      //       };

      //       image.src = event.target.result;
      //     };

      //     reader.readAsDataURL(file);

      //     // Call change function to update preview image and show modal if necessary
      //     change(e, cropperId);
      //   });

      //   // Function to handle closing modal
      //   bs_modal.on("hidden.bs.modal", function () {
      //     // Destroy all croppers
      //     croppers.forEach(function (cropper) {
      //       cropper.destroy();
      //     });
      //     croppers = []; // Reset croppers array
      //   });
      // }); -->